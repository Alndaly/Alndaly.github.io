"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[6569],{82025:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>p,metadata:()=>r,toc:()=>s});var a=n(87462),i=(n(67294),n(3905));n(16758);const p={},l=void 0,r={unversionedId:"frontend/Swift/SwiftUi/\u8fdc\u7a0b\u901a\u77e5",id:"frontend/Swift/SwiftUi/\u8fdc\u7a0b\u901a\u77e5",title:"\u8fdc\u7a0b\u901a\u77e5",description:"\u8bc1\u4e66\u6a21\u5f0f",source:"@site/docs/frontend/Swift/SwiftUi/\u8fdc\u7a0b\u901a\u77e5.md",sourceDirName:"frontend/Swift/SwiftUi",slug:"/frontend/Swift/SwiftUi/\u8fdc\u7a0b\u901a\u77e5",permalink:"/docs/frontend/Swift/SwiftUi/\u8fdc\u7a0b\u901a\u77e5",draft:!1,editUrl:"https://github.com/alndaly/alndaly.github.io/edit/docusaurus/docs/frontend/Swift/SwiftUi/\u8fdc\u7a0b\u901a\u77e5.md",tags:[],version:"current",lastUpdatedAt:1671289529,formattedLastUpdatedAt:"2022\u5e7412\u670817\u65e5",frontMatter:{},sidebar:"frontEndSidebar",previous:{title:"\u672c\u5730\u901a\u77e5",permalink:"/docs/frontend/Swift/SwiftUi/\u672c\u5730\u901a\u77e5"},next:{title:"\u91cd\u542fapp\u540e\u6570\u636e\u4fdd\u5b58",permalink:"/docs/frontend/Swift/SwiftUi/\u91cd\u542fapp\u540e\u6570\u636e\u4fdd\u5b58"}},o={},s=[{value:"\u8bc1\u4e66\u6a21\u5f0f",id:"\u8bc1\u4e66\u6a21\u5f0f",level:2},{value:"Token\u6a21\u5f0f",id:"token\u6a21\u5f0f",level:2},{value:"\u751f\u6210Token",id:"\u751f\u6210token",level:3}],k={toc:s};function d(t){let{components:e,...n}=t;return(0,i.kt)("wrapper",(0,a.Z)({},k,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"\u8bc1\u4e66\u6a21\u5f0f"},"\u8bc1\u4e66\u6a21\u5f0f"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u53bb",(0,i.kt)("a",{parentName:"li",href:"https://developer.apple.com/account/resources/identifiers/list"},"Apple\u5f00\u53d1\u8005\u5b98\u7f51"),"\u65b0\u5efa\u4e00\u4e2aAPP\u5e76\u4e14\u5f00\u542f\u63a8\u9001\u6743\u9650\u3002")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212151736791.png",alt:null})),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212151737433.png",alt:null})),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u914d\u7f6e\u672c\u5730\u6d4b\u8bd5\u8bc1\u4e66"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u672c\u5730\u751f\u6210csr\u6587\u4ef6"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u6253\u5f00Keychain Access\n",(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212151757359.png",alt:null}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u914d\u7f6e\u8bc1\u4e66\n",(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212151758906.png",alt:null})),(0,i.kt)("p",{parentName:"li"}," \u9009\u62e9\u4fdd\u5b58\u5230\u672c\u5730\uff08\u6b64\u65f6\u4e0d\u9700\u8981\u4e0a\u4f20\u5230ca\u8ba4\u8bc1\uff09\n",(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212151800048.png",alt:null}))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0a\u4f20CSR\u6587\u4ef6\n",(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212151803306.png",alt:null}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u4e0b\u8f7d\u8bc1\u4e66\n",(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212151804864.png",alt:null}))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u914d\u7f6e\u53d1\u5e03\u8bc1\u4e66\uff08\u5982\u679c\u9700\u8981\uff0c\u90a3\u4e48\u5177\u4f53\u64cd\u4f5c\u540c\u4e0a\uff09")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u53cc\u51fb\u4e0b\u8f7d\u4e0b\u6765\u7684\u8bc1\u4e66\u52a0\u5230KeyChain Access"))),(0,i.kt)("h2",{id:"token\u6a21\u5f0f"},"Token\u6a21\u5f0f"),(0,i.kt)("h3",{id:"\u751f\u6210token"},"\u751f\u6210Token"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_token-based_connection_to_apns"},"\u5b98\u7f51\u6587\u6863")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u751f\u6210\u65b0\u7684key")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://developer.apple.com/account/resources/authkeys/list"},"Apple Developer")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212161140314.png",alt:null})),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212161141832.png",alt:null})),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"\u6570\u636e\u51c6\u5907")),(0,i.kt)("p",null,"KEYID"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212161143310.png",alt:null})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://developer.apple.com/account"},"Apple Developer\u8d26\u53f7\u4fe1\u606f")),(0,i.kt)("p",null,"\u56e2\u961fID\uff1a"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://upload.kinda.info/image/202212161151053.png",alt:null})),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Key"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"alg")),(0,i.kt)("td",{parentName:"tr",align:null},"\u7f16\u7801\u7b97\u6cd5\uff0c\u82f9\u679c\u76ee\u524d\u53ea\u652f\u6301",(0,i.kt)("inlineCode",{parentName:"td"},"ES256"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"kid")),(0,i.kt)("td",{parentName:"tr",align:null},"\u4e0a\u9762\u8bb0\u5f55\u4e0b\u6765\u7684Key ID")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"iss")),(0,i.kt)("td",{parentName:"tr",align:null},"\u4f60\u7684\u5f00\u53d1\u8005\u8d26\u53f7\u7684Team ID")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"iat")),(0,i.kt)("td",{parentName:"tr",align:null},"Token\u7684\u751f\u6210\u65f6\u95f4\uff08UTC\u65f6\u533a\uff0c\u4eceEpoch\u4ee5\u6765\u7684\u79d2\u6570\uff09")))),(0,i.kt)("p",null,"JSON\u793a\u4f8b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "alg" : "ES256",\n   "kid" : "ABC123DEFG"\n}\n{\n   "iss": "DEF123GHIJ",\n   "iat": 1437179036\n}\n')),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"JWT\u7f16\u7801")),(0,i.kt)("p",null,"python\u7248\u672c"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'import jwt\nimport time\n\npayload = {\n    "iss": teamId,\n    "iat": time.time()\n}\n\nheaders = {\n    "alg" : "ES256",\n    "kid" : keyId\n}\n\n# Apple Developer\u4e0b\u8f7d\u7684p8\u6587\u4ef6\nwith open(\'./AuthKey_****.p8\', \'r\') as f:\n    privateKey = f.read()\n\ntoken = jwt.encode(payload=payload, algorithm=\'ES256\', headers=headers, key=privateKey)\nprint(\'token:\', token)\n')),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"\u6ce8\u518c\u7ec8\u7aef\u5e76\u4e14\u83b7\u53d6deviceToken")),(0,i.kt)("p",null,"\u65b0\u5efa\u4e00\u4e2aAppDelegate\u6587\u4ef6\u53bb\u5bf9\u5e94\u5e94\u7528\u7684\u751f\u547d\u5468\u671f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-swift",metastring:"title=AppDelegate.swift",title:"AppDelegate.swift"},'import SwiftUI\n\n// \u6269\u5c55Data\uff0c\u5c06Data\u7f16\u7801\u8f6c\u6210\u6b63\u5e38\u5b57\u7b26\u4e32\nextension Data {\n    var hexString: String {\n        return map { String(format: "%02.2hhx", arguments: [$0]) }.joined()\n    }\n}\n\nclass AppDelegate: NSObject, UIApplicationDelegate {\n    func application(_ application: UIApplication,\n               didFinishLaunchingWithOptions launchOptions:\n                     [UIApplication.LaunchOptionsKey: Any]?) -> Bool {\n       // Override point for customization after application launch.you\u2019re\n       // \u7533\u8bf7\u6ce8\u518c\u672c\u673a\n        UIApplication.shared.registerForRemoteNotifications()\n        return true\n    }\n\n    func application(_ application: UIApplication,\n                didRegisterForRemoteNotificationsWithDeviceToken\n                    deviceToken: Data) {\n                     // \u5982\u679c\u6ce8\u518c\u6210\u529f\uff0c\u90a3\u4e48\u4f1a\u8c03\u7528\u6b64\u5904\u51fd\u6570\n        print("deviceToken:", deviceToken.hexString)\n//       self.sendDeviceTokenToServer(data: deviceToken)\n    }\n\n    func application(_ application: UIApplication,\n                didFailToRegisterForRemoteNotificationsWithError\n                    error: Error) {\n        print("error:", error)\n       // Try again later.\n    }\n}\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"didRegisterForRemoteNotificationsWithDeviceToken"),"\u8fd4\u56de\u7684deviceToken\u9ed8\u8ba4\u5df2\u7ecf\u53d8\u6210Data\u683c\u5f0f\uff0c\u8981\u8f6c\u6210\u5b57\u7b26\u4e32\u9700\u8981\u6269\u5c55Data\u7c7b\u578b\uff0c\u6216\u8005\u76f4\u63a5\u5904\u7406\u6570\u636e\u4e5f\u884c\u3002"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-swift"},'// \u6269\u5c55Data\uff0c\u5c06Data\u7f16\u7801\u8f6c\u6210\u6b63\u5e38\u5b57\u7b26\u4e32\nextension Data {\n    var hexString: String {\n        return map { String(format: "%02.2hhx", arguments: [$0]) }.joined()\n    }\n}\n'))),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},"\u5e94\u7528\u7533\u8bf7\u901a\u77e5\u6743\u9650")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-swift"},'func requestNotificationAuth(){\n   let center = UNUserNotificationCenter.current()\n   \n   center.requestAuthorization(options: [.alert, .badge, .sound]) { success, error in\n      if success {\n            print("\u7533\u8bf7\u6743\u9650\u6210\u529f\u3002")\n      } else {\n            print("D\'oh!")\n      }\n   }\n}\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"\u5982\u679c\u6ca1\u6709\u8c03\u7528",(0,i.kt)("inlineCode",{parentName:"p"},"didFinishLaunchingWithOptions"),"\uff0c\u53ef\u80fd\u662f\u4f60\u6ca1\u6709\u6388\u6743\u5e94\u7528\uff0c\u53bb\u8bbe\u7f6e\uff0c\u901a\u77e5\u91cc\u9762\u68c0\u67e5\u4e00\u4e0b\u6743\u9650\u72b6\u6001\u3002")))}d.isMDXComponent=!0}}]);